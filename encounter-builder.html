<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5E 2025 Encounter Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
            min-height: 600px;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .content-area {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #f0f2ff;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3em;
            color: #2a5298;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .monster-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .monster-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .monster-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .monster-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2a5298;
        }

        .monster-cr {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .monster-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 2px;
        }

        .stat-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .monster-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.9em;
        }

        .encounter-summary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .encounter-summary h3 {
            margin-bottom: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 6px;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .reference-table {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #2a5298;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .reference-text {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .reference-text strong {
            color: #2a5298;
        }

        .monster-library {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .encounter-monsters {
            min-height: 200px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-right: 5px;
        }

        .role-brute { background: #ff6b6b; color: white; }
        .role-soldier { background: #4ecdc4; color: white; }
        .role-controller { background: #9b59b6; color: white; }
        .role-lurker { background: #2c3e50; color: white; }
        .role-artillery { background: #f39c12; color: white; }
        .role-minion { background: #95a5a6; color: white; }
        .role-leader { background: #27ae60; color: white; }

        .encounter-type-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .encounter-type-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .encounter-type-card.selected {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .encounter-type-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 8px;
        }

        .encounter-type-desc {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .hazard-tag {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 3px;
        }

        .grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
                max-height: none;
            }

            .grid-2col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öîÔ∏è 5E 2025 Encounter Builder</h1>
            <p class="subtitle">Create monsters and balance encounters using official 5E 2025 rules</p>
        </header>

        <div class="main-content">
            <div class="sidebar">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('generate')">Generate</button>
                    <button class="tab-btn" onclick="switchTab('create')">Create</button>
                    <button class="tab-btn" onclick="switchTab('encounter')">Encounter</button>
                    <button class="tab-btn" onclick="switchTab('reference')">Reference</button>
                </div>

                <div id="generate-tab" class="tab-content active">
                    <div class="section">
                        <h3 class="section-title">Generate Encounter</h3>
                        
                        <div class="form-group">
                            <label>Party Level</label>
                            <select id="gen-party-level">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Party Size</label>
                            <input type="number" id="gen-party-size" value="4" min="1" max="8">
                        </div>

                        <div class="form-group">
                            <label>Difficulty</label>
                            <select id="gen-difficulty">
                                <option value="low">Easy (Low)</option>
                                <option value="moderate">Medium (Moderate)</option>
                                <option value="high">Hard (High)</option>
                                <option value="deadly">Deadly (Very Hard)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Encounter Type</label>
                            <select id="gen-encounter-type">
                                <option value="">Select Type...</option>
                                <option value="solo">Solo/Boss Battle</option>
                                <option value="horde">Horde/Swarm</option>
                                <option value="wolfpack">Wolf Pack/Skirmishers</option>
                                <option value="ambush">Ambush</option>
                                <option value="elite">Elite Team/Targeted Strike</option>
                                <option value="standard">Standard (Balanced Mix)</option>
                                <option value="hazard">Stomping Ground (Hazard Focus)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Environmental Hazards</label>
                            <select id="gen-hazards">
                                <option value="none">None</option>
                                <option value="light">Light (Minor obstacles)</option>
                                <option value="moderate">Moderate (Active hazards)</option>
                                <option value="heavy">Heavy (Deadly terrain)</option>
                            </select>
                        </div>

                        <button onclick="generateEncounter()">üé≤ Generate Encounter</button>
                    </div>

                    <div class="section" style="margin-top: 20px;">
                        <h3 class="section-title">Encounter Types</h3>
                        <div class="reference-text">
                            <strong>Solo/Boss:</strong> One powerful creature with elite stats
                        </div>
                        <div class="reference-text">
                            <strong>Horde:</strong> Many weak minions
                        </div>
                        <div class="reference-text">
                            <strong>Wolf Pack:</strong> Fast skirmishers that hit and run
                        </div>
                        <div class="reference-text">
                            <strong>Ambush:</strong> Hidden enemies with surprise tactics
                        </div>
                        <div class="reference-text">
                            <strong>Elite Team:</strong> Small group of specialists
                        </div>
                        <div class="reference-text">
                            <strong>Standard:</strong> Balanced mix of roles
                        </div>
                        <div class="reference-text">
                            <strong>Stomping Ground:</strong> Terrain and hazards are the challenge
                        </div>
                    </div>
                </div>

                <div id="create-tab" class="tab-content">
                    <div class="section">
                        <h3 class="section-title">Create Monster</h3>
                        
                        <div class="form-group">
                            <label>Monster Name</label>
                            <input type="text" id="monster-name" placeholder="e.g., Goblin Scout">
                        </div>

                        <div class="form-group">
                            <label>Challenge Rating (CR)</label>
                            <select id="monster-cr">
                                <option value="0">0</option>
                                <option value="1/4">1/4</option>
                                <option value="1/2">1/2</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Monster Role (4e Style)</label>
                            <select id="monster-role">
                                <option value="">None</option>
                                <option value="brute">Brute (High HP, High Damage)</option>
                                <option value="soldier">Soldier (High AC, Defender)</option>
                                <option value="controller">Controller (Area Effects, Debuffs)</option>
                                <option value="lurker">Lurker (Stealth, Ambush)</option>
                                <option value="artillery">Artillery (Ranged, High Damage)</option>
                                <option value="minion">Minion (1 HP, Swarm)</option>
                                <option value="leader">Leader (Buffs Allies)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>XP Value</label>
                            <input type="number" id="monster-xp" readonly>
                        </div>

                        <button onclick="autoFillStats()">Auto-Fill from CR</button>
                        
                        <div class="form-group">
                            <label>Armor Class (AC)</label>
                            <input type="number" id="monster-ac" placeholder="12">
                        </div>

                        <div class="form-group">
                            <label>Hit Points (HP)</label>
                            <input type="number" id="monster-hp" placeholder="9">
                        </div>

                        <div class="form-group">
                            <label>Attack Bonus</label>
                            <input type="number" id="monster-attack" placeholder="+2">
                        </div>

                        <div class="form-group">
                            <label>Damage per Round</label>
                            <input type="number" id="monster-damage" placeholder="3">
                        </div>

                        <div class="form-group">
                            <label>Save DC</label>
                            <input type="number" id="monster-dc" placeholder="10">
                        </div>

                        <div class="form-group">
                            <label>Details (Optional)</label>
                            <textarea id="monster-details" placeholder="Special abilities, traits, actions..."></textarea>
                        </div>

                        <button onclick="addMonster()">‚ûï Add Monster</button>
                    </div>
                </div>

                <div id="encounter-tab" class="tab-content">
                    <div class="section">
                        <h3 class="section-title">Encounter Setup</h3>
                        
                        <div class="form-group">
                            <label>Party Level</label>
                            <select id="party-level">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Number of Characters</label>
                            <input type="number" id="party-size" value="4" min="1" max="8">
                        </div>

                        <div class="form-group">
                            <label>Difficulty</label>
                            <select id="difficulty">
                                <option value="low">Low</option>
                                <option value="moderate">Moderate</option>
                                <option value="high">High</option>
                            </select>
                        </div>

                        <button onclick="calculateBudget()">Calculate XP Budget</button>
                        <button class="btn-secondary" onclick="clearEncounter()">Clear Encounter</button>
                    </div>
                </div>

                <div id="reference-tab" class="tab-content">
                    <div class="section">
                        <h3 class="section-title">Quick Reference</h3>
                        
                        <div class="reference-text">
                            <strong>AC:</strong> ¬± 3 based on monster concept
                        </div>
                        
                        <div class="reference-text">
                            <strong>HP:</strong> ¬± 50% based on concept. Reduce for high damage ability.
                        </div>
                        
                        <div class="reference-text">
                            <strong>Attack:</strong> ¬± 2 based on concept
                        </div>
                        
                        <div class="reference-text">
                            <strong>Damage:</strong> ¬± 50% based on concept. Budget for multi-target.
                        </div>
                        
                        <div class="reference-text">
                            <strong>Save:</strong> Bonus to saves/skills based on concept
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-area">
                <div id="encounter-summary" class="encounter-summary" style="display: none;">
                    <h3>Encounter Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">XP Budget</div>
                            <div class="summary-value" id="xp-budget">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">XP Spent</div>
                            <div class="summary-value" id="xp-spent">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Remaining XP</div>
                            <div class="summary-value" id="xp-remaining">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Creatures</div>
                            <div class="summary-value" id="creature-count">0</div>
                        </div>
                    </div>
                </div>

                <div id="budget-alerts"></div>

                <div class="section">
                    <h3 class="section-title">Monster Library</h3>
                    <div id="monster-library" class="monster-library">
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            <p>No monsters yet. Create your first monster!</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">Current Encounter</h3>
                    <div id="encounter-monsters" class="encounter-monsters">
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <p>No creatures in encounter. Add monsters from your library!</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">Stat Guidelines by CR</h3>
                    <div class="reference-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>CR</th>
                                    <th>AC</th>
                                    <th>HP</th>
                                    <th>Attack</th>
                                    <th>Damage</th>
                                    <th>DC</th>
                                    <th>Save</th>
                                </tr>
                            </thead>
                            <tbody id="stat-guidelines-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structures
        const monsters = [];
        const encounter = [];
        let xpBudget = 0;
        let environmentalHazards = [];

        // Monster roles and their stat modifiers
        const roleModifiers = {
            brute: { ac: -2, hp: 1.5, attack: 0, damage: 1.5, dc: 0 },
            soldier: { ac: 2, hp: 1.2, attack: 1, damage: 0.8, dc: 0 },
            controller: { ac: 0, hp: 0.8, attack: 0, damage: 0.8, dc: 2 },
            lurker: { ac: 1, hp: 0.8, attack: 2, damage: 1.3, dc: 1 },
            artillery: { ac: -1, hp: 0.7, attack: 1, damage: 1.4, dc: 0 },
            minion: { ac: 0, hp: 0.05, attack: 0, damage: 0.5, dc: 0 },
            leader: { ac: 1, hp: 1.1, attack: 0, damage: 0.9, dc: 1 }
        };

        // Environmental hazards by type
        const hazardTemplates = {
            light: [
                { name: 'Difficult Terrain', description: 'Rubble, thick vegetation, or shallow water', effect: 'Half movement speed' },
                { name: 'Low Obstacles', description: 'Crates, furniture, low walls', effect: 'Half cover (+2 AC, +2 DEX saves)' },
                { name: 'Dim Light', description: 'Shadows, fog, or smoke', effect: 'Lightly obscured area' }
            ],
            moderate: [
                { name: 'Pit Traps', description: 'DC 13 DEX save or fall 10ft (1d6 damage)', effect: 'Prone on failure' },
                { name: 'Fire Zone', description: 'DC 12 DEX save or 2d6 fire damage', effect: 'Enters or starts turn in area' },
                { name: 'Unstable Ground', description: 'DC 11 DEX save or fall prone', effect: 'When moving through area' },
                { name: 'Magical Darkness', description: 'Heavily obscured area', effect: 'Disadvantage on attacks' }
            ],
            heavy: [
                { name: 'Lava Pools', description: 'DC 15 DEX save or 4d10 fire damage', effect: 'Immense heat in area' },
                { name: 'Collapsing Ceiling', description: 'DC 14 DEX save or 4d6 bludgeoning', effect: 'Triggered by loud noise' },
                { name: 'Poisonous Gas', description: 'DC 13 CON save or 3d6 poison + poisoned', effect: 'Fills area each round' },
                { name: 'Lightning Pillars', description: 'DC 15 DEX save or 3d8 lightning', effect: 'Strikes random target each round' },
                { name: 'Freezing Winds', description: 'DC 12 CON save or 2d6 cold + slowed', effect: 'Constant effect in area' }
            ]
        };

        // CR to XP mapping
        const crToXP = {
            '0': 10,
            '1/8': 25,
            '1/4': 50,
            '1/2': 100,
            '1': 200,
            '2': 450,
            '3': 700,
            '4': 1100,
            '5': 1800,
            '6': 2300,
            '7': 2900,
            '8': 3900,
            '9': 5000,
            '10': 5900,
            '11': 7200,
            '12': 8400,
            '13': 10000,
            '14': 11500,
            '15': 13000,
            '16': 15000,
            '17': 18000,
            '18': 20000,
            '19': 22000,
            '20': 25000
        };

        // XP Budget per character based on level and difficulty
        const xpBudgetTable = {
            1: { low: 50, moderate: 75, high: 100 },
            2: { low: 100, moderate: 150, high: 200 },
            3: { low: 150, moderate: 225, high: 400 },
            4: { low: 250, moderate: 375, high: 550 },
            5: { low: 550, moderate: 750, high: 1100 },
            6: { low: 600, moderate: 1000, high: 1400 },
            7: { low: 750, moderate: 1300, high: 1700 },
            8: { low: 1000, moderate: 1700, high: 2100 },
            9: { low: 1300, moderate: 2000, high: 2600 },
            10: { low: 1600, moderate: 2300, high: 3100 },
            11: { low: 1900, moderate: 2900, high: 4100 },
            12: { low: 2200, moderate: 3700, high: 4700 },
            13: { low: 2600, moderate: 4200, high: 5400 },
            14: { low: 2900, moderate: 4900, high: 6200 },
            15: { low: 3300, moderate: 5400, high: 7800 },
            16: { low: 3800, moderate: 6100, high: 9800 },
            17: { low: 4500, moderate: 7200, high: 11700 },
            18: { low: 5000, moderate: 8700, high: 14200 },
            19: { low: 5500, moderate: 10700, high: 17200 },
            20: { low: 6400, moderate: 13200, high: 22000 }
        };

        // Stat guidelines by CR
        const statGuidelines = [
            { cr: '0', ac: 12, hp: 3, attack: 2, damage: 1, dc: 9, save: 1 },
            { cr: '1/8', ac: 12, hp: 9, attack: 3, damage: 3, dc: 10, save: 2 },
            { cr: '1/4', ac: 13, hp: 15, attack: 3, damage: 5, dc: 10, save: 2 },
            { cr: '1/2', ac: 13, hp: 24, attack: 4, damage: 8, dc: 11, save: 3 },
            { cr: '1', ac: 13, hp: 30, attack: 4, damage: 10, dc: 11, save: 3 },
            { cr: '2-7', ac: '13 + ¬ΩCR', hp: '(15 √ó CR) + 15', attack: '4 + ¬ΩCR', damage: '(5 √ó CR) + 5', dc: '11 + ¬ΩCR', save: '3 + ¬ΩCR' },
            { cr: '8+', ac: '13 + ¬ΩCR', hp: '15 √ó CR', attack: '4 + ¬ΩCR', damage: '5 √ó CR', dc: '11 + ¬ΩCR', save: '3 + ¬ΩCR' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            populateStatGuidelinesTable();
            updateCRXP();
            
            document.getElementById('monster-cr').addEventListener('change', updateCRXP);
        });

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }

        function updateCRXP() {
            const cr = document.getElementById('monster-cr').value;
            const xp = crToXP[cr] || 0;
            document.getElementById('monster-xp').value = xp;
        }

        function calculateStatFromCR(cr, type) {
            const crNum = cr.includes('/') ? eval(cr) : parseFloat(cr);
            
            switch(type) {
                case 'ac':
                    return Math.round(13 + (crNum / 2));
                case 'hp':
                    if (crNum >= 8) {
                        return Math.round(15 * crNum);
                    } else if (crNum >= 2) {
                        return Math.round((15 * crNum) + 15);
                    } else if (crNum === 1) {
                        return 30;
                    } else if (crNum === 0.5) {
                        return 24;
                    } else if (crNum === 0.25) {
                        return 15;
                    } else if (crNum === 0.125) {
                        return 9;
                    } else {
                        return 3;
                    }
                case 'attack':
                    return Math.round(4 + (crNum / 2));
                case 'damage':
                    if (crNum >= 8) {
                        return Math.round(5 * crNum);
                    } else if (crNum >= 2) {
                        return Math.round((5 * crNum) + 5);
                    } else if (crNum === 1) {
                        return 10;
                    } else if (crNum === 0.5) {
                        return 8;
                    } else if (crNum === 0.25) {
                        return 5;
                    } else if (crNum === 0.125) {
                        return 3;
                    } else {
                        return 1;
                    }
                case 'dc':
                    return Math.round(11 + (crNum / 2));
                case 'save':
                    return Math.round(3 + (crNum / 2));
            }
        }

        function autoFillStats() {
            const cr = document.getElementById('monster-cr').value;
            const role = document.getElementById('monster-role').value;
            
            let ac = calculateStatFromCR(cr, 'ac');
            let hp = calculateStatFromCR(cr, 'hp');
            let attack = calculateStatFromCR(cr, 'attack');
            let damage = calculateStatFromCR(cr, 'damage');
            let dc = calculateStatFromCR(cr, 'dc');
            
            // Apply role modifiers
            if (role && roleModifiers[role]) {
                const mods = roleModifiers[role];
                ac += mods.ac;
                hp = Math.round(hp * mods.hp);
                attack += mods.attack;
                damage = Math.round(damage * mods.damage);
                dc += mods.dc;
            }
            
            document.getElementById('monster-ac').value = ac;
            document.getElementById('monster-hp').value = hp;
            document.getElementById('monster-attack').value = attack;
            document.getElementById('monster-damage').value = damage;
            document.getElementById('monster-dc').value = dc;
        }

        function addMonster() {
            const name = document.getElementById('monster-name').value.trim();
            const cr = document.getElementById('monster-cr').value;
            const role = document.getElementById('monster-role').value;
            const xp = parseInt(document.getElementById('monster-xp').value);
            const ac = parseInt(document.getElementById('monster-ac').value);
            const hp = parseInt(document.getElementById('monster-hp').value);
            const attack = parseInt(document.getElementById('monster-attack').value);
            const damage = parseInt(document.getElementById('monster-damage').value);
            const dc = parseInt(document.getElementById('monster-dc').value);
            const details = document.getElementById('monster-details').value.trim();

            if (!name) {
                alert('Please enter a monster name');
                return;
            }

            const monster = {
                id: Date.now(),
                name,
                cr,
                role,
                xp,
                ac: ac || 0,
                hp: hp || 0,
                attack: attack || 0,
                damage: damage || 0,
                dc: dc || 0,
                details
            };

            monsters.push(monster);
            renderMonsterLibrary();
            
            // Clear form
            document.getElementById('monster-name').value = '';
            document.getElementById('monster-details').value = '';
        }

        function deleteMonster(id) {
            const index = monsters.findIndex(m => m.id === id);
            if (index > -1) {
                monsters.splice(index, 1);
                renderMonsterLibrary();
            }
        }

        function addToEncounter(id) {
            const monster = monsters.find(m => m.id === id);
            if (monster) {
                encounter.push({...monster, encounterId: Date.now()});
                renderEncounter();
                updateEncounterSummary();
            }
        }

        function removeFromEncounter(encounterId) {
            const index = encounter.findIndex(m => m.encounterId === encounterId);
            if (index > -1) {
                encounter.splice(index, 1);
                renderEncounter();
                updateEncounterSummary();
            }
        }

        function clearEncounter() {
            encounter.length = 0;
            environmentalHazards = [];
            renderEncounter();
            updateEncounterSummary();
        }

        function clearHazards() {
            environmentalHazards = [];
            renderEncounter();
        }

        function generateEncounter() {
            const level = parseInt(document.getElementById('gen-party-level').value);
            const size = parseInt(document.getElementById('gen-party-size').value);
            const difficulty = document.getElementById('gen-difficulty').value;
            const encounterType = document.getElementById('gen-encounter-type').value;
            const hazardLevel = document.getElementById('gen-hazards').value;

            if (!encounterType) {
                alert('Please select an encounter type');
                return;
            }

            // Clear existing encounter
            encounter.length = 0;
            environmentalHazards = [];

            // Calculate XP budget (deadly = high + 50%)
            const baseDifficulty = difficulty === 'deadly' ? 'high' : difficulty;
            const budgetPerChar = xpBudgetTable[level][baseDifficulty];
            xpBudget = budgetPerChar * size;
            
            if (difficulty === 'deadly') {
                xpBudget = Math.floor(xpBudget * 1.5);
            }

            // Generate hazards
            if (hazardLevel !== 'none') {
                const hazards = hazardTemplates[hazardLevel];
                const numHazards = hazardLevel === 'light' ? 1 : hazardLevel === 'moderate' ? 2 : 3;
                for (let i = 0; i < numHazards && i < hazards.length; i++) {
                    environmentalHazards.push(hazards[i]);
                }
            }

            // Adjust budget if using hazards (reduce XP for creatures)
            let creatureBudget = xpBudget;
            if (hazardLevel === 'moderate') creatureBudget *= 0.8;
            if (hazardLevel === 'heavy') creatureBudget *= 0.6;

            // Generate creatures based on type
            switch (encounterType) {
                case 'solo':
                    generateSoloEncounter(level, creatureBudget);
                    break;
                case 'horde':
                    generateHordeEncounter(level, creatureBudget);
                    break;
                case 'wolfpack':
                    generateWolfPackEncounter(level, creatureBudget);
                    break;
                case 'ambush':
                    generateAmbushEncounter(level, creatureBudget);
                    break;
                case 'elite':
                    generateEliteEncounter(level, creatureBudget);
                    break;
                case 'standard':
                    generateStandardEncounter(level, creatureBudget);
                    break;
                case 'hazard':
                    generateHazardEncounter(level, creatureBudget);
                    break;
            }

            // Update UI
            document.getElementById('encounter-summary').style.display = 'block';
            renderEncounter();
            updateEncounterSummary();
            
            // Switch to encounter tab
            switchTab('encounter');
        }

        function generateSoloEncounter(level, budget) {
            // One big boss creature at 80% of budget
            const bossCR = findClosestCR(budget * 0.8);
            const boss = createGeneratedMonster('Boss', bossCR, 'brute', 'Elite enemy with legendary actions');
            encounter.push(boss);
            
            // Add a few minions with remaining budget
            const minionCR = Math.max(0, level - 3);
            const minionXP = crToXP[minionCR.toString()] || 25;
            const minionCount = Math.floor((budget - boss.xp) / minionXP);
            
            for (let i = 0; i < Math.min(minionCount, 4); i++) {
                encounter.push(createGeneratedMonster(`Minion ${i + 1}`, minionCR, 'minion', 'Swarm enemy'));
            }
        }

        function generateHordeEncounter(level, budget) {
            // Lots of minions
            const minionCR = Math.max(0, level - 4);
            const minionXP = crToXP[minionCR.toString()] || 25;
            const count = Math.floor(budget / minionXP);
            
            for (let i = 0; i < Math.min(count, 12); i++) {
                encounter.push(createGeneratedMonster(`Horde ${i + 1}`, minionCR, 'minion', '1 HP - killed by any damage'));
            }
        }

        function generateWolfPackEncounter(level, budget) {
            // Fast skirmishers
            const cr = level;
            const xp = crToXP[cr.toString()] || 200;
            const count = Math.floor(budget / xp);
            
            for (let i = 0; i < Math.min(count, 6); i++) {
                encounter.push(createGeneratedMonster(`Skirmisher ${i + 1}`, cr, 'lurker', 'Fast movement, hit and run tactics'));
            }
        }

        function generateAmbushEncounter(level, budget) {
            // Mix of lurkers and controllers
            const lurkerCR = level + 1;
            const lurkerXP = crToXP[lurkerCR.toString()] || 200;
            const lurkerCount = Math.floor(budget * 0.6 / lurkerXP);
            
            for (let i = 0; i < Math.min(lurkerCount, 3); i++) {
                encounter.push(createGeneratedMonster(`Ambusher ${i + 1}`, lurkerCR, 'lurker', 'Hidden, surprise round'));
            }
            
            const controllerCR = level;
            const controllerXP = crToXP[controllerCR.toString()] || 200;
            const controllerCount = Math.floor((budget - lurkerCount * lurkerXP) / controllerXP);
            
            for (let i = 0; i < Math.min(controllerCount, 2); i++) {
                encounter.push(createGeneratedMonster(`Controller ${i + 1}`, controllerCR, 'controller', 'Area control, crowd control'));
            }
        }

        function generateEliteEncounter(level, budget) {
            // Small team of specialists
            const roles = ['soldier', 'artillery', 'controller', 'leader'];
            const cr = level + 1;
            const xp = crToXP[cr.toString()] || 200;
            const count = Math.min(Math.floor(budget / xp), 4);
            
            for (let i = 0; i < count; i++) {
                const role = roles[i % roles.length];
                encounter.push(createGeneratedMonster(`Elite ${role}`, cr, role, `Specialized ${role} tactics`));
            }
        }

        function generateStandardEncounter(level, budget) {
            // Balanced mix
            const leaderCR = level + 1;
            const leaderXP = crToXP[leaderCR.toString()] || 200;
            encounter.push(createGeneratedMonster('Leader', leaderCR, 'leader', 'Commands and buffs allies'));
            
            let remaining = budget - leaderXP;
            
            // Add soldiers
            const soldierCR = level;
            const soldierXP = crToXP[soldierCR.toString()] || 200;
            const soldierCount = Math.floor(remaining * 0.5 / soldierXP);
            for (let i = 0; i < Math.min(soldierCount, 2); i++) {
                encounter.push(createGeneratedMonster(`Soldier ${i + 1}`, soldierCR, 'soldier', 'Frontline defender'));
                remaining -= soldierXP;
            }
            
            // Add artillery
            const artilleryCR = level;
            const artilleryXP = crToXP[artilleryCR.toString()] || 200;
            if (remaining >= artilleryXP) {
                encounter.push(createGeneratedMonster('Artillery', artilleryCR, 'artillery', 'Ranged damage dealer'));
                remaining -= artilleryXP;
            }
            
            // Fill with minions
            const minionCR = Math.max(0, level - 3);
            const minionXP = crToXP[minionCR.toString()] || 25;
            const minionCount = Math.floor(remaining / minionXP);
            for (let i = 0; i < Math.min(minionCount, 4); i++) {
                encounter.push(createGeneratedMonster(`Minion ${i + 1}`, minionCR, 'minion', 'Support unit'));
            }
        }

        function generateHazardEncounter(level, budget) {
            // Fewer creatures, more hazards
            environmentalHazards = [];
            
            // Add 3-5 hazards
            const allHazards = [...hazardTemplates.light, ...hazardTemplates.moderate, ...hazardTemplates.heavy];
            const hazardCount = 3 + Math.floor(Math.random() * 3);
            for (let i = 0; i < hazardCount; i++) {
                const hazard = allHazards[Math.floor(Math.random() * allHazards.length)];
                if (!environmentalHazards.find(h => h.name === hazard.name)) {
                    environmentalHazards.push(hazard);
                }
            }
            
            // Add just a few creatures
            const cr = level;
            const xp = crToXP[cr.toString()] || 200;
            const count = Math.floor((budget * 0.5) / xp);
            
            for (let i = 0; i < Math.min(count, 4); i++) {
                encounter.push(createGeneratedMonster(`Guardian ${i + 1}`, cr, 'soldier', 'Defends the hazardous terrain'));
            }
        }

        function createGeneratedMonster(baseName, cr, role, details) {
            const crKey = cr.toString();
            const xp = crToXP[crKey] || 200;
            
            let ac = calculateStatFromCR(crKey, 'ac');
            let hp = calculateStatFromCR(crKey, 'hp');
            let attack = calculateStatFromCR(crKey, 'attack');
            let damage = calculateStatFromCR(crKey, 'damage');
            let dc = calculateStatFromCR(crKey, 'dc');
            
            // Apply role modifiers
            if (role && roleModifiers[role]) {
                const mods = roleModifiers[role];
                ac += mods.ac;
                hp = Math.round(hp * mods.hp);
                attack += mods.attack;
                damage = Math.round(damage * mods.damage);
                dc += mods.dc;
            }
            
            return {
                id: Date.now() + Math.random(),
                encounterId: Date.now() + Math.random(),
                name: baseName,
                cr: crKey,
                role,
                xp,
                ac,
                hp,
                attack,
                damage,
                dc,
                details
            };
        }

        function findClosestCR(targetXP) {
            let closestCR = '0';
            let closestDiff = Math.abs(crToXP['0'] - targetXP);
            
            for (const [cr, xp] of Object.entries(crToXP)) {
                const diff = Math.abs(xp - targetXP);
                if (diff < closestDiff) {
                    closestDiff = diff;
                    closestCR = cr;
                }
            }
            
            return closestCR;
        }

        function calculateBudget() {
            const level = parseInt(document.getElementById('party-level').value);
            const size = parseInt(document.getElementById('party-size').value);
            const difficulty = document.getElementById('difficulty').value;

            const budgetPerChar = xpBudgetTable[level][difficulty];
            xpBudget = budgetPerChar * size;

            document.getElementById('encounter-summary').style.display = 'block';
            updateEncounterSummary();
        }

        function updateEncounterSummary() {
            const spent = encounter.reduce((sum, m) => sum + m.xp, 0);
            const remaining = xpBudget - spent;
            const count = encounter.length;

            document.getElementById('xp-budget').textContent = xpBudget;
            document.getElementById('xp-spent').textContent = spent;
            document.getElementById('xp-remaining').textContent = remaining;
            document.getElementById('creature-count').textContent = count;

            // Show alerts
            const alertsDiv = document.getElementById('budget-alerts');
            alertsDiv.innerHTML = '';

            if (remaining < 0) {
                alertsDiv.innerHTML = '<div class="alert alert-danger">‚ö†Ô∏è Over budget! This encounter is harder than intended.</div>';
            } else if (remaining > 0 && spent > 0) {
                alertsDiv.innerHTML = '<div class="alert alert-success">‚úì Within budget. ' + remaining + ' XP remaining.</div>';
            }

            // Check for many creatures
            const partySize = parseInt(document.getElementById('party-size').value) || 4;
            if (count > partySize * 2) {
                alertsDiv.innerHTML += '<div class="alert alert-warning">‚ö†Ô∏è Many creatures! Consider using fragile monsters that can be defeated quickly.</div>';
            }
        }

        function renderMonsterLibrary() {
            const container = document.getElementById('monster-library');
            
            if (monsters.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        <p>No monsters yet. Create your first monster!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = monsters.map(m => `
                <div class="monster-card">
                    <div class="monster-header">
                        <div>
                            <div class="monster-name">${m.name}</div>
                            ${m.role ? `<span class="role-badge role-${m.role}">${m.role.charAt(0).toUpperCase() + m.role.slice(1)}</span>` : ''}
                        </div>
                        <div class="monster-cr">CR ${m.cr}</div>
                    </div>
                    <div class="monster-stats">
                        <div class="stat-item">
                            <div class="stat-label">AC</div>
                            <div class="stat-value">${m.ac}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">HP</div>
                            <div class="stat-value">${m.hp}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ATK</div>
                            <div class="stat-value">+${m.attack}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">DMG</div>
                            <div class="stat-value">${m.damage}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">DC</div>
                            <div class="stat-value">${m.dc}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">XP</div>
                            <div class="stat-value">${m.xp}</div>
                        </div>
                    </div>
                    ${m.details ? `<div style="margin-top: 10px; font-size: 0.9em; color: #666;">${m.details}</div>` : ''}
                    <div class="monster-actions">
                        <button class="btn-small" onclick="addToEncounter(${m.id})">Add to Encounter</button>
                        <button class="btn-small btn-danger" onclick="deleteMonster(${m.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function renderEncounter() {
            const container = document.getElementById('encounter-monsters');
            
            if (encounter.length === 0 && environmentalHazards.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <p>No creatures in encounter. Add monsters from your library!</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            // Render environmental hazards
            if (environmentalHazards.length > 0) {
                html += '<div class="monster-card" style="border-color: #e74c3c;"><div class="monster-header"><div class="monster-name" style="color: #e74c3c;">üåã Environmental Hazards</div></div>';
                environmentalHazards.forEach(h => {
                    html += `<div style="margin: 10px 0; padding: 10px; background: #fff5f5; border-radius: 4px;">
                        <div style="font-weight: bold; color: #e74c3c;">${h.name}</div>
                        <div style="font-size: 0.9em; color: #666; margin: 5px 0;">${h.description}</div>
                        <div style="font-size: 0.85em; color: #c0392b; font-style: italic;">Effect: ${h.effect}</div>
                    </div>`;
                });
                html += '<div class="monster-actions"><button class="btn-small btn-danger" onclick="clearHazards()">Clear Hazards</button></div></div>';
            }
            
            // Render monsters
            html += encounter.map(m => `
                <div class="monster-card">
                    <div class="monster-header">
                        <div>
                            <div class="monster-name">${m.name}</div>
                            ${m.role ? `<span class="role-badge role-${m.role}">${m.role.charAt(0).toUpperCase() + m.role.slice(1)}</span>` : ''}
                        </div>
                        <div class="monster-cr">CR ${m.cr}</div>
                    </div>
                    <div class="monster-stats">
                        <div class="stat-item">
                            <div class="stat-label">AC</div>
                            <div class="stat-value">${m.ac}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">HP</div>
                            <div class="stat-value">${m.hp}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ATK</div>
                            <div class="stat-value">+${m.attack}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">DMG</div>
                            <div class="stat-value">${m.damage}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">DC</div>
                            <div class="stat-value">${m.dc}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">XP</div>
                            <div class="stat-value">${m.xp}</div>
                        </div>
                    </div>
                    ${m.details ? `<div style="margin-top: 10px; font-size: 0.9em; color: #666;">${m.details}</div>` : ''}
                    <div class="monster-actions">
                        <button class="btn-small btn-danger" onclick="removeFromEncounter(${m.encounterId})">Remove</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function populateStatGuidelinesTable() {
            const tbody = document.getElementById('stat-guidelines-table');
            tbody.innerHTML = statGuidelines.map(row => `
                <tr>
                    <td>${row.cr}</td>
                    <td>${row.ac}</td>
                    <td>${row.hp}</td>
                    <td>${row.attack}</td>
                    <td>${row.damage}</td>
                    <td>${row.dc}</td>
                    <td>${row.save}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
